name: Build AND PUSH JET PLAN DOC

on: [push, delete, create]

jobs:
    git-mirror:
        runs-on: ubuntu-latest
        steps:
            - name: Configure Private Key
              env:
                  SSH_PRIVATE_KEY: ${{ secrets.JETUIDOC_RSA_PRIVATE_KEY }}
              run: |
                  mkdir -p ~/.ssh
                  echo "$SSH_PRIVATE_KEY" > ~/.ssh/id_rsa
                  chmod 600 ~/.ssh/id_rsa
                  echo "StrictHostKeyChecking no" >> ~/.ssh/config
            - name: build and push
              env:
                  SOURCE_REPO: 'https://github.com/abchiyi/Jet-Plan-UI.git'
                  DESTINATION_REPO: 'git@github.com:jetplanui/jetplanui.github.io.git'
              run: |
                  git clone https://github.com/abchiyi/Jet-Plan-UI.git ~/resource_temp
                  cd  ~/resource_temp
                  npm install
                  npm run build
                  cd ./dist
                  git config --global user.email "meme_me2019@outlook.com"
                  git config --global user.name "abchiyi"
                  git init
                  git add .
                  git commit -am 'update-doc'
                  git remote set-url --push origin "$DESTINATION_REPO"
                  git fetch -p origin
                  git for-each-ref --format 'delete %(refname)' refs/pull | git update-ref --stdin
                  git push --mirror
